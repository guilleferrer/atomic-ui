/*
 * atomic.ui
 * Version: 0.0.1 - 2014-05-14
 * License: EULA
 * Author: Guillermo Ferrer <guilleferrer@gmail.com>
 */
angular.module("ui.atomic",["pascalprecht.translate","ui.atomic.tpls","ui.atomic.alerts","ui.atomic.back","ui.atomic.compile","ui.atomic.confirm","ui.atomic.fbinvite","ui.atomic.filter","ui.atomic.viewport","ui.atomic.full-screen","ui.atomic.infinite-scroll","ui.atomic.pager","ui.atomic.list","ui.atomic.mailto","ui.atomic.ng-name","ui.atomic.multiple-choice","ui.atomic.nl2br","ui.atomic.search-box","ui.atomic.testabit","ui.atomic.tools","ui.atomic.truncate","ui.atomic.urlencode","ui.atomic.user-advice","ui.atomic.whatsapp"]),angular.module("ui.atomic.tpls",["template/confirm/confirm.html","template/filter/button.html","template/filter/modal.html","template/full-screen/full-screen.html","template/list/list-item.html","template/list/paged-list.html","template/multiple-choice/multiple-choice-modal.html","template/multiple-choice/multiple-choice-picker.html","template/search-box/search-box.html","template/testabit/modal.html"]),angular.module("ui.atomic.alerts",["ui.bootstrap.alert"]).run(["$rootScope","$timeout",function(a,b){a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)};var c=function(c){a.alerts.push(c),b(function(){a.alerts.pop()},3500)};a.$on("submit.error",function(){c({type:"danger",msg:"alerts.form.validationMessage",keep:!1})}),a.$on("alert.show",function(a,b){c(b)}),a.$on("$stateChangeSuccess",function(){for(var b=a.alerts.length-1;b>=0;b--)a.alerts[b].keep||a.closeAlert(b)})}]),angular.module("ui.atomic.back",[]).directive("back",["$window",function(a){return function(b,c){c.on("click",function(){a.history.back()})}}]),angular.module("ui.atomic.compile",[],["$compileProvider",function(a){a.directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}])}]),angular.module("ui.atomic.confirm",["ui.bootstrap"]).directive("confirmUrl",["$http","$window","$modal",function(a,b,c){return{scope:{title:"@confirmTitle",message:"@confirmMessage",buttonYes:"@confirmYes",buttonNo:"@confirmNo"},link:function(d,e,f){var g=f.confirmUrl,h=f.confirmMethod||"delete",i=f.actionBtnClass||"btn-ml-danger",j="true"==f.followUrl;e.bind("click",function(e){e.preventDefault(),d.buttons=[{label:d.buttonYes,result:1,cssClass:i},{label:d.buttonNo,result:0,cssClass:"btn-ml-default"}];var f=c.open({scope:d,templateUrl:"template/confirm/confirm.html"});return d.close=function(a){f.close(a)},f.result.then(function(c){1===c&&(j===!0?b.location=g:a[h](g).success(function(a){d.$emit("apiEvent.ACTION_SUCCESS",a)}))}),!1})}}}]),angular.module("ui.atomic.fbinvite",[]).factory("Facebook",function(){var a=function(a,b){FB.ui({method:"apprequests",filters:["app_non_users"],title:a.title,message:a.message},function(a){a&&b&&b(a)})};return{fb:function(){return FB},requestNonAppFriends:function(b,c){a(b,c)}}}).directive("fbinvite",["$http, Facebook",function(a,b){return{restrict:"A",link:function(a,c,d){var e=b;if(angular.isUndefined(d.fbinviteMessage))throw"fbinvite-message parameter is required";var f={title:d.fbinviteTitle,message:d.fbinviteMessage};c.on("click",function(){e.requestNonAppFriends(f)})}}}]),angular.module("ui.atomic.filter",["ui.bootstrap"]).factory("filterStorage",function(){function a(a,b){c[a]=b}function b(a){return c[a]||{}}var c={};return{save:a,get:b}}).directive("modalFilter",["$modal","filterStorage",function(a,b){return{restrict:"E",templateUrl:"template/filter/button.html",replace:!0,scope:{title:"@",text:"@",cancelLabel:"@",resetLabel:"@",applyLabel:"@",formName:"@",formUrl:"@"},link:function(c){c.showFilter=function(){c.$modal=a.open({windowClass:"full-modal",templateUrl:"template/filter/modal.html",scope:c}),c.$modal.result.then(function(a){c.$emit("filterEvent.FILTER_CHANGE",a)}),c.resetFilter=function(){c.$broadcast("filter.reset")},c.applyFilter=function(){c.$broadcast("filter.apply"),c.$modal.close(b.get(c.formName))}}}}}]).directive("modalFilterForm",["filterStorage",function(a){return{require:"form",link:function(b,c,d){var e=d.name;angular.extend(b[e],a.get(e)),b.$on("filter.reset",function(){a.save(e,{}),b[e]={}}),b.$on("filter.apply",function(){a.save(e,b[e])})}}}]),angular.module("ui.atomic.full-screen",["ui.bootstrap","angular-carousel","ui.atomic.viewport"]).directive("fullScreen",["$modal","viewport",function(a,b){return{scope:{images:"=fullScreen"},link:function(c,d){var e;d.on("click",function(){e=a.open({windowClass:"full-modal full-screen",templateUrl:"template/full-screen/full-screen.html",scope:c}),e.opened.then(function(){b.set("maximum-scale","2")}),e.result.then(function(){b.set("maximum-scale","1")})}),c.cancel=function(){e.close()}}}}]),angular.module("ui.atomic.infinite-scroll",[]).directive("infiniteScroll",["$rootScope","$window","$timeout",function(a,b,c){return{link:function(d,e,f){var g,h,i,j;return b=angular.element(b),i=0,null!=f.infiniteScrollDistance&&d.$watch(f.infiniteScrollDistance,function(a){return i=parseFloat(a)}),j=!0,g=!1,null!=f.infiniteScrollDisabled&&d.$watch(f.infiniteScrollDisabled,function(a){return j=!a,j&&g?(g=!1,h()):void 0}),h=function(){var c,h,k,l;return l=b.height(),c=e.offset().top+e.height(),h=c-l,k=20*i>=h,k&&j?a.$$phase?d.$eval(f.infiniteScroll):d.$apply(f.infiniteScroll):k?g=!0:void 0},e.parents(".scroller").on("scroll",h),d.$on("$destroy",function(){return e.parents(".scroller").off("scroll",h)}),c(function(){return f.infiniteScrollImmediateCheck?d.$eval(f.infiniteScrollImmediateCheck)?h():void 0:h()},0)}}}]),angular.module("ui.atomic.pager",[]).provider("pagerCache",function(){this.$get=["$cacheFactory",function(a){return a("pager")}]}).provider("Pager",function(){var a=1;this.setInitialPage=function(b){a=b},this.$get=["$http","$rootScope","pagerCache",function(b,c,d){function e(b,c,d){this.id=(new Date).getTime(),this.search=c||{},this.middleware=d||function(a){return a},this.url=b,this.page=a,this.finished=!1,this.busy=!1,this.showNoResults=!1,this.results=[],this.nbResults=0,this.nbUnread=0}function f(a,b){var c=[];for(var d in a){var e=b?b+"["+d+"]":d,g=a[d];c.push("object"==typeof g?f(g,e):encodeURIComponent(e)+"="+encodeURIComponent(g))}return c.join("&")}return e.prototype.nextPage=function(a,e){var g={};if(e!==!1&&(g.cache=d),!this.busy&&!this.finished){this.busy=!0;var h=this.url;this.search=angular.extend(this.search,{page:this.page});var i=f(this.search);h+=i?"?"+i:"";var j=this;b.get(h,g).then(function(b){var d=b.data;return j.busy=!1,j.nbResults=d.nbResults,j.nbUnread+=d.nbUnread,j.showNoResults=0==d.results.length,angular.forEach(d.results,function(a){j.results.push(j.middleware(a))}),0==d.nbPages&&0==j.results.length&&c.$broadcast("pager.no_results",j.id),angular.isFunction(a)&&a(j),c.$broadcast("pager.page_loaded",j.page,j.results),d.nbPages==j.page||0==d.results.length?(j.finished=!0,void c.$broadcast("pager.last_page")):void(j.page+=1)})}},e}]}),angular.module("ui.atomic.list",["ui.atomic.pager","ui.atomic.infinite-scroll"]).directive("list",["Pager","$rootScope",function(a,b){return{restrict:"E",templateUrl:"template/list/paged-list.html",replace:!0,transclude:!0,link:function(c,d,e){c.listClass=e.listClass||"list-group",c.listCache=e.$attr.listNoCache?!1:!0;var f=c.$eval(e.apiQuery)||{};c.pager=new a(e.apiUrl,f),b.$on("searchEvent.SEARCH_CHANGE",function(b,d,g){angular.extend(f,g),c.pager=new a(e.apiUrl,f),c.pager.nextPage()})}}}]).directive("listItem",function(){return{restrict:"E",replace:!0,templateUrl:function(a,b){return b.itemTplUrl||"template/list/list-item.html"}}}),angular.module("ui.atomic.mailto",[]).directive("mailto",function(){return{restrict:"A",scope:{mailto:"="},link:function(a,b,c){var d=c.mailto,e=c.mailtoSubject,f=c.mailtoContent;b.bind("click",function(){window.location="mailto:"+d+"?subject="+e+"&body="+encodeURIComponent(f)}),a.$watch("mailto",function(a){a&&(d=a)})}}}),angular.module("ui.atomic.ng-name",[]).directive("ngName",ngNameDirective=function(){return{priority:100,restrict:"A",require:"ngModel",link:{pre:function(a,b,c,d){if(!d)throw"Error , ngName requires ngModel";d.$name=a.$eval(c.ngName),c.$set("name",d.$name)}}}}),angular.module("ui.atomic.multiple-choice",["ui.bootstrap","ui.atomic.ng-name"]).directive("multipleChoice",["$modal","$log","$filter",function(a,b,c){return{restrict:"E",scope:{choices:"=",ngModel:"=",modalHeader:"@",modalFooter:"@"},transclude:!0,templateUrl:"template/multiple-choice/multiple-choice-picker.html",link:function(b,d){function e(a){a.selected=!0}b.selectToggle=function(a){a.selected=!a.selected},d.on("click",function(){var d=b.ngModel;angular.forEach(b.ngModel,e),b.$modal=a.open({windowClass:"full-modal",templateUrl:"template/multiple-choice/multiple-choice-modal.html",scope:b}),b.$modal.result.then(function(){b.ngModel=c("filter")(b.choices,{selected:!0})},function(){b.ngModel=d})})}}}]),angular.module("ui.atomic.nl2br",[]).filter("nl2br",[function(){return function(a,b){if(a){var b=b||!0,c=b?"<br />":"<br>",a=(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+c+"$2");return a}return""}}]),angular.module("ui.atomic.search-box",[]).directive("searchBox",["$timeout",function(a){return{restrict:"E",replace:!0,templateUrl:"template/search-box/search-box.html",scope:{placeholder:"@"},link:function(b){function c(a){""!=a&&b.$emit("searchEvent.SEARCH_CHANGE",a)}var d;b.erase=function(){b.search=""},b.$watch("search",function(b,e){b!==e&&(a.cancel(d),d=a(function(){c(b)},1e3))})}}}]),angular.module("ui.atomic.testabit",["angulartics","angulartics","ui.bootstrap"]).config(["$analyticsProvider",function(a){var b="/";a.registerPageTrack(function(a){b=a,window.ga&&window.ga("send","pageview",a),window.plugins&&window.plugins.gaPlugin&&window.plugins.gaPlugin.trackPage(function(){},function(){},a)}),a.registerEventTrack(function(a,c){if(window.ga&&window.ga("send","event",c.category,a,c.label,{page:b}),window.plugins&&window.plugins.gaPlugin){var d=function(){console.log("successEventTrack")},e=function(){console.log("errorEventTrack")};window.plugins.gaPlugin.trackEvent(d,e,c.category,a,c.label,-1)}})}]).provider("testabit",function(){var a=[],b=["silent","modal"],c=!1;this.setDebugMode=function(a){c=a},this.setCategories=function(b){if(!angular.isArray(b))throw"Categories for testabit should be an array";a=b},this.$get=["$log","$analytics",function(d,e){function f(a,b,f,g){var h={category:a,label:f};""!==g&&(h.value=g),c&&d.log("Testabit.eventTrack : ","action: ",b,"/ category: ",h.category,"/ label: ",h.label),e.eventTrack(b,h)}var g={};return angular.extend(g,{eventTrack:f,allowedCategories:a,allowedTypes:b,debugMode:c}),g}]}).directive("testabit",["testabit","$log","$modal","$translate",function(a,b,c,d){function e(a){return"testabit error : "+a}function f(c){var d=!1;return-1===a.allowedTypes.indexOf(c.testabit)&&(b.log(e("Invalid testabit parameter '"+c.testabitCategory+"' . The testabit type should be one of these : "),a.allowedTypes),d=!0),"modal"===c.testabit&&(c.testabitModalTitle||(b.log(e("Invalid modal title '"+c.testabitModalTitle+"' . You have configured testabit type modal, so you must introduce the title of the modal")),d=!0),c.testabitModalMessage||(b.log(e("Invalid modal message '"+c.testabitModalMessage+"' . You have configured testabit type modal, so you must introduce the message of the modal")),d=!0)),-1===a.allowedCategories.indexOf(c.testabitCategory)&&(b.log(e("Invalid category '"+c.testabitCategory+"' . The category should be one of these : "),a.allowedCategories),d=!0),c.testabitAction||(b.log(e("Invalid action '"+c.testabitAction+"'")),d=!0),c.testabitLabel||(b.log(e("Invalid label '"+c.testabitLabel+"'")),d=!0),d?!1:{category:c.testabitCategory,action:c.testabitAction,label:c.testabitLabel,value:c.testabitValue}}return function(b,e,g){a.debugMode&&e.css("border","2px dashed white");var h=function(){var h=f(g);if(h===!1)return void(a.debugMode&&e.css("border","2px dashed red"));if("modal"===g.testabit){var i=[{label:"testabit.button.no",result:0,cssClass:"btn-default"},{label:"testabit.button.yes",result:1,cssClass:"btn-primary"}],j=c.open({templateUrl:"template/testabit/modal.html",controller:"MessageBoxController",resolve:{model:function(){return{title:g.testabitModalTitle,message:g.testabitModalMessage,buttons:i}}}});j.result.then(function(c){function e(a){b.$emit("alert.show",{type:"success",msg:a,keep:!1})}var f=parseInt(c)>0?"positive_vote":"negative_vote";a.eventTrack(h.category,h.action+"."+f,h.label,c),d("testabit.alert.thankyou_message").then(e,e)})}else a.eventTrack(h.category,h.action,h.label,h.value)};e.bind("click",function(){b.$apply(h)})}}]).controller("MessageBoxController",["$scope","$modalInstance","model",function(a,b,c){a.close=function(a){b.close(a)},a.buttons=c.buttons,a.title=c.title,a.message=c.message}]),angular.module("ui.atomic.tools",[]).factory("urlTools",function(){function a(b,c){var d=[];for(var e in b){var f=c?c+"["+e+"]":e,g=b[e];d.push("object"==typeof g?a(g,f):encodeURIComponent(f)+"="+encodeURIComponent(g))}return d.join("&")}function b(a){try{return decodeURIComponent(a)}catch(b){}}function c(a){var c,d,e={};return angular.forEach((a||"").split("&"),function(a){if(a&&(c=a.split("="),d=b(c[0]),angular.isDefined(d))){var f=angular.isDefined(c[1])?b(c[1]):!0;e[d]?isArray(e[d])?e[d].push(f):e[d]=[e[d],f]:e[d]=f}}),e}return{toKeyValue:a,parseKeyValue:c}}),angular.module("ui.atomic.viewport",[]).factory("viewport",function(){function a(){var a=angular.element('meta[name="viewport"]').attr("content");return b(a)}function b(a){var b={},c=a.replace(/ /g,"").split(",");return angular.forEach(c,function(a){var b=a.split("=");this[b[0]]=b[1]},b),b}function c(a){var b=[];return angular.forEach(a,function(a,c){b.push(c+"="+a)}),b.join(",")}function d(a,b){e[a]=b;var d=c(e);angular.element('meta[name="viewport"]').attr("content",d)}var e=a();return{get:a,set:d}}),angular.module("ui.atomic.truncate",[]).filter("truncate",function(){return function(a,b,c){return a?(isNaN(b)&&(b=100),void 0===c&&(c="..."),a.length<=b||a.length-c.length<=b?a:String(a).substring(0,b-c.length)+c):""}}),angular.module("ui.atomic.urlencode",[]).filter("urlencode",[function(){return function(a){return encodeURIComponent(a)}}]),angular.module("ui.atomic.user-advice",[]).directive("userAdvice",["$http, $document, $rootScope",function(a,b,c){return{link:function(d,e,f){var g=f.userAdvice,h="/api/advices/"+g+"/disable",i=function(){d.$apply(function(){a.get(h),b.find(".advice-"+g).remove(),c.$broadcast("advice.disable",g)})};e.bind("click",i)}}}]),angular.module("ui.atomic.whatsapp",["adaptive.detection"]).directive("whatsapp",["$window","$detection","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){b.isiOS()?d.bind("click",function(){a.location="whatsapp://send?text="+encodeURIComponent(e.whatsapp)}):d.hide()}}}]),angular.module("template/confirm/confirm.html",[]).run(["$templateCache",function(a){a.put("template/confirm/confirm.html",'<div class="modal-body">\n    <h4 class="margin-add-bottom-10">{{ title }}</h4>\n\n    <p class="medium-paragraph">{{ message }}</p>\n</div>\n<div class="modal-footer">\n    <ul class="buttons-list padding-add-x-20 padding-add-bottom-20 margin-rm-all">\n        <li ng-repeat="btn in buttons">\n            <button\n                    ng-click="close(btn.result)"\n                    class="btn btn-block"\n                    ng-class="btn.cssClass">\n                {{ btn.label }}\n            </button>\n        </li>\n    </ul>\n</div>')}]),angular.module("template/filter/button.html",[]).run(["$templateCache",function(a){a.put("template/filter/button.html",'<a class="btn btn-icon" data-ng-click="showFilter()">\n    <i class="ml-icon-65"></i>\n    Show filter\n</a>')}]),angular.module("template/filter/modal.html",[]).run(["$templateCache",function(a){a.put("template/filter/modal.html",'<div class="modal-header">\n    {{ title }}\n    <button class="btn btn-link pull-right" data-ng-click="$modal.dismiss()"><i class="ml-icon-30"></i></button>\n</div>\n<div class="modal-body" ng-include="formUrl"></div>\n<div class="modal-footer">\n    <ul class="buttons-holder btn-btn">\n        <li>\n            <button type="button" data-ng-click="resetFilter()" class="btn btn-block">\n                {{ resetLabel }}\n            </button>\n        </li>\n        <li>\n            <button type="button" data-ng-click="applyFilter()" class="btn btn-block btn-primary">\n                {{ applyLabel }}\n            </button>\n        </li>\n    </ul>\n</div>')}]),angular.module("template/full-screen/full-screen.html",[]).run(["$templateCache",function(a){a.put("template/full-screen/full-screen.html",'<button class="btn btn-link pull-right" data-ng-click="cancel()"><i class="ml-icon-30"></i></button>\n<div class="modal-body testabit">\n    <ul data-rn-carousel data-rn-carousel-control class="image">\n        <li ng-repeat="image in images">\n            <img ng-src="{{ image.url }}"/>\n        </li>\n    </ul>\n</div>')}]),angular.module("template/list/list-item.html",[]).run(["$templateCache",function(a){a.put("template/list/list-item.html",'<li class="media padding-add-all-10 border-add-bottom">\n    <a class="media-item-link clickable" data-on-click="mediaItemClick()">\n        <img class="media-object masked pull-left" data-ng-src="{{ item.imageUrl }}">\n        <div class="media-body">\n            <h4 class="media-heading">{{ item.title }}</h4>\n            <p>{{ item.description }}</p>\n            <span class="media-badge ">{{ item.badge }}</span>\n        </div>\n    </a>\n\n</li>')}]),angular.module("template/list/paged-list.html",[]).run(["$templateCache",function(a){a.put("template/list/paged-list.html",'<div class="paged-list-container">\n    <ul data-ng-class="listClass" data-infinite-scroll="pager.nextPage(angular.noop, listCache)" data-infinite-scroll-distance="1" data-ng-transclude>\n        <list-item data-ng-repeat="result in pager.results"></list-item>\n    </ul>\n\n    <span id="spinner-mini" data-us-spinner="{lines: 13, length: 0, width: 5, radius: 14, corners: 1, rotate: 0,\n'+"    direction: 1, color: '#000', speed: 1.7, trail: 100, shadow: false, hwaccel: false, className: 'spinner', zIndex:\n    2e9, top: 'auto', left: 'auto' }\"></span>\n</div>")}]),angular.module("template/multiple-choice/multiple-choice-modal.html",[]).run(["$templateCache",function(a){a.put("template/multiple-choice/multiple-choice-modal.html",'<div class="modal-header">\n    {{ modalHeader }}\n    <button class="btn btn-link pull-right" data-ng-click="$modal.dismiss(\'cancel\')"><i class="ml-icon-30"></i></button>\n</div>\n<div class="modal-body">\n    <div class="list-group decorated w-check">\n        <a class="list-group-item" ng-repeat="choice in choices"\n           ng-click="selectToggle(choice)" ng-class="{ true: \'active\' }[choice.selected]">\n            <p class="list-group-item-text" ng-bind="choice.name"></p>\n        </a>\n    </div>\n</div>\n<div class="modal-footer">\n    <ul class="buttons-holder">\n        <li>\n            <button class="btn btn-block btn-primary" ng-click="$modal.close()">\n                {{ modalFooter }}\n            </button>\n        </li>\n    </ul>\n</div>')}]),angular.module("template/multiple-choice/multiple-choice-picker.html",[]).run(["$templateCache",function(a){a.put("template/multiple-choice/multiple-choice-picker.html",'<div>\n    <div ng-transclude=""></div>\n    <select multiple class="hidden" ng-model="ngModel"\n            ng-options="c.name for c in choices">\n    </select>\n</div>')}]),angular.module("template/search-box/search-box.html",[]).run(["$templateCache",function(a){a.put("template/search-box/search-box.html",'<div class="form-group search-type-w-icon">\n    <i class="ml-icon-52"></i>\n    <input type="search" class="form-control"\n           placeholder="{{ placeholder }}"\n           data-ng-model="search"/>\n    <a href="" ng-click="erase()" class="clear-form">\n        <i class="ml-icon-33"></i>\n    </a>\n</div>')}]),angular.module("template/testabit/modal.html",[]).run(["$templateCache",function(a){a.put("template/testabit/modal.html",'<div class="modal-body testabit">\n    <i class="ml-icon-54"></i>\n    <h4>{{ title }}</h4>\n    <p>{{ message }}</p>\n</div>\n<div class="modal-footer">\n    <ul class="double-btn padding-add-x-20 padding-add-bottom-10 margin-rm-all">\n        <li ng-repeat="btn in buttons">\n            <button ng-click="close(btn.result)"\n                    class="btn"\n                    ng-class="btn.cssClass">\n                {{ btn.label | translate }}\n            </button>\n        </li>\n    </ul>\n</div>')}]);